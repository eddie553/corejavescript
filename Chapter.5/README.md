# Chapter.5

## 클로저 : 어떤 함수에서 선언한 변수를 참조하는 내부함수에서만 발생하는 현상

### ex. 5-1

[외부 함수의 변수를 참조하는 내부 함수(1)]

inner 내부 함수에서 a를 선언하지 않았기 때문에 외부 함수의 변수 a를 찾는다.
이 때 그 데이터 값을 가르키는 클로저가 내부 함수가 선언될 때 함께 생성된다.

- 모든 자바스크립트 함수는 선언될 시 클로저가 형성되며 클로저 환경을 기억한다.
- 외부 함수가 콜 스택에서 사라져도 클로저는 사라지지 않는다.

### ex. 5-2

[외부 함수의 변수를 참조하는 내부 함수(2)]

예제 5-1과 달리 외부 함수 outer를 수행시킨 결과를 outer2에 할당한다.
즉, 결과값인 데이터 영역의 2를 가르키는 주소를 할당한 것.

### ex. 5-3

[외부 함수의 변수를 참조하는 내부 함수(3)]

예제 5-1, 5-2와 달리 outer의 return이 inner 함수의 주소값이다.
outer2()의 수행 시점에서 outer는 콜 스택에서 사라진 상태인데도,
변수 영역의 콜 스택에서 outer가 사라져도 데이터 영역의 클로저는 사라지지 않으므로
inner 함수를 실행한 결과와 같다.

### ex. 5-4

[return 없이도 클로저가 발생하는 다양한 경우]
(1) 콘솔에 1부터 1씩 증가하여 10까지 1초마다 출력된다.
(2) 클릭 이벤트 발생 시마다 count가 1씩 증가하며 "timesclicked" 출력된다.

### ex. 5-5

[클로저의 메모리 관리]

클로저 메모리 해제하기.
필요성이 사라진 클로저는 참조 카운트를 0으로 만들기 위해 기본형 데이터(null)를 할당한다.

1. return에 의한 클로저의 메모리 해제
2. setInterval에 의한 클로저의 메모리 해제
3. eventListener에 의한 클로저의 메모리 해제

### ex. 5-6

[콜백 함수와 클로저(1)]

addEventListener에 넘겨준 콜백 함수는 fruit이라는 외부 변수를 참조하는 클로저가 존재.

### ex. 5-7

[콜백 함수와 클로저(2)]

예제 5-6의 공통 함수를 콜백 함수를 외부로 꺼내어 alertFruit에 할당.
addEventListner는 콜백 함수를 호출할 때 첫 번째 인자에 이벤트 객체를 주입하므로 잘못된 예제.
결과 : your choice is banana alert창이 바로 나타남 + you choice is [object PointerEvent]

### ex. 5-8

[콜백 함수와 클로저(3)]

예제 5-7를 수정.
bind 메서드를 이용하여 fruit 인자를 올바르게 넘겨준다. (클로저는 사용하지 않음)

### ex. 5-9

[콜백 함수와 클로저(4) - 고차함수]

alertFuitBuilder 변수가 함수를 반환하도록 수정. (클로저가 존재)
콜백 함수가 클로저를 사용하여 클릭 이벤트 발생 시 클로저 사용.

### ex. 5-10

[간단한 자동차 객체의 문제점]

자동차 객체에서 프로퍼티값을 변경할 수 있는 문제.

### ex. 5-11

[클로저로 변수를 보호한 자동차 객체(1)]
객체가 아닌 함수로 만들고, 필요한 멤버만을 return 하기

클로저 : moved, power, fuel

함수에서 return 값으로 getter와 run 메서드를 프로퍼티로 가지는 객체를 반환한다.
데이터 영역에 있는 클로저는 garbage collection 되지 않는다.
외부에서는 run메서드를 실행하거나 moved 값을 확인하는 것만 가능하다.

- moved는 getter에 의해 read only
- fuel, power은 접근 불가능

* return한 변수들은 공개 멤버가 되고, 그렇지 않은 변수들은 비공개 멤버.
* car.fuel=1000; 은 별개의 새로운 프로퍼티를 만드는 것이고, 게임에서 설정한 fuel과는 관련없는 값이 된다

### ex. 5-12

[클로저로 변수를 보호한 자동차 객체(2)]

### ex. 5-13

[bind 메서드를 활용한 부분 적용 함수]

addPartial 함수는 인자 5개를 미리 적용하고, 추후 추가적으로 인자들을 전달하면 모든 인자들을 모아 원래의 함수가 실행된다.

- bind 메서드만으로 구현 - this의 값을 지정, 내부 함수에서 클로저 존재 X

### ex. 5-14

[부분 적용 함수 구현 (1) - 클로저 이용]

1. add 함수
   클로저 : originalPartialArgs, func - 상수로 고정되어 미리 적용할 인자들. [add,1,2,3,4,5]
   restArgs : addPartial 실행 시 인자들 arguments. [6,7,8,9,10]
   (21 line) [add,1,2,3,4,5] array-like 형태로 partial에 전달
   (07 line return 부분) array-like 연산을 위해 call 메서드를 활용
   add=func로 전달, [1,2,3,4,5]=partialArgs로 연산됨.

2. dog.greet 메서드
   클로저를 참조하여 string 합치는 메서드
   클로저 : originalPartialArgs, func - 상수로 고정되어 미리 적용할 인자들. [function,'왈왈']
   restArgs : addPartial 실행 시 인자들 arguments. ['입니다']

### ex. 5-15

[부분 적용 함수 구현 (2) - 클로저 이용]

1. add 함수
   '_'인 엘리먼트를 찾아 restArgs의 엘리먼트로 할당하는 함수
   클로저 : originalPartialArgs, func - 상수로 고정되어 미리 적용할 인자들. [add,1,2,_,4,5*,*,8,9]
   restArgs : addPartial 실행 시 인자들 arguments. [3,6,7,10]

2. dog.greet 메서드
   클로저를 참조하여 string 합치는 메서드
   클로저 : originalPartialArgs, func - 상수로 고정되어 미리 적용할 인자들. [function,'왈왈,']
   restArgs : addPartial 실행 시 인자들 arguments. ['배고파요!']

### ex. 5-16

[부분 적용 함수 - 디바운스]

클로저 : eventName, func, wai, timeoutId
setTimeout의 인자로 클로저 func를 호출한다.
우스무브 이벤트가 500ms 안에 다시 발생한다면 초기화되고, 다시 발생하지 않고 500ms가 지나면 인자로 전달한 func가 호출된다.
결과 : Test Debug with Live Server 텍스트 위에서 마우스휠, 마우스무브 이벤트 발생 시 콘솔에 문구 출력.

### ex. 5-17

[커링 함수]

- 커링 함수
  - 여러 개의 인자를 받는 함수를 하나의 인자만 받는 함수로 나눠서 순차적으로 호출될 수 있게 체인 형태로 구성한 것.
  - 마지막 인자가 전달되기 전까지는 원본 함수가 실행되지 않는다.

클로저 : (f1) a, (curry3) func
필요한 인자 개수만큼 함수를 만들어 계속 리턴해준다.

### ex. 5-18

[커링 함수]

필요한 인자 개수만큼 함수를 만들어 계속 리턴해줄 때, 인자가 많아질 수록 가독성이 떨어진다.
-> ES6 화살표 함수를 써서 한 줄 표기 가능(this는 존재하지 않는다)
